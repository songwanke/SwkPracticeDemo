**分布式和集群的区别：**  
一句话：分布式是并联工作的，集群是串联工作的。  
分布式：一个业务分拆多个子业务，部署在不同的服务器上  
集群：同一个业务，部署在多个服务器上  
集群是个物理形态，分布式是个工作方式。  
只要是一堆机器，就可以叫集群，他们是不是一起协作着干活，这个谁也不知道；一个程序或系统，只要运行在不同的机器上，就可以叫分布式，嗯，C/S架构也可以叫分布式。  
只要是一堆机器，就可以叫集群，他们是不是一起协作着干活，这个谁也不知道；一个程序或系统，只要运行在不同的机器上，就可以叫分布式，嗯，C/S架构也可以叫分布式。  
集群可能运行着一个或多个分布式系统，也可能根本没有运行分布式系统；分布式系统可能运行在一个集群上，也可能运行在不属于一个集群的多台（2台也算多台）机器上。  

1：分布式是指将不同的业务分布在不同的地方。 而集群指的是将几台服务器集中在一起，实现同一业务。  
分布式中的每一个节点，都可以做集群。 而集群并不一定就是分布式的。  
2：简单说，分布式是以缩短单个任务的执行时间来提升效率的，而集群则是通过提高单位时间内执行的任务数来提升效率。  

例如：

如果一个任务由10个子任务组成，每个子任务单独执行需1小时，则在一台服务器上执行该任务需10小时。

采用分布式方案，提供10台服务器，每台服务器只负责处理一个子任务，不考虑子任务间的依赖关系，执行完这个任务只需一个小时。(这种工作模式的一个典型代表就是Hadoop的Map/Reduce分布式计算模型）

而采用集群方案，同样提供10台服务器，每台服务器都能独立处理这个任务。假设有10个任务同时到达，10个服务器将同时工作，1小时后，10个任务同时完成，这样，整身来看，还是1小时内完成一个任务！  

**分布式系统基础架构：**  
Hadoop（Hadoop的框架最核心的设计就是：HDFS和MapReduce。HDFS为海量的数据提供了存储，则MapReduce为海量的数据提供了计算）  

**分布式系统解决方案：**  
Apache HTTP Server+tomcat+redis+mysql 分布式数据库+分布式文件系统  
Nginx+Tomcat+redis+mysql 分布式数据库+分布式文件系统  

### 系统架构演变
**系统架构演化历程-初始阶段架构**  
初始阶段 的小型系统 应用程序、数据库、文件等所有的资源都在一台服务器上通俗称为LAMP  
**解决方案：** 单机部署  

**系统架构演化历程-应用服务和数据服务分离**  
数据量增加，单台服务器性能及存储空间不足，需要将应用和数据分离，并发处理能力和数据存储空间得到了很大改善。  
应用程序、数据库、文件分别部署在独立的资源上  
**解决方案：** 多机部署应用、数据库、文件  

**系统架构演化历程-使用缓存改善性能**  
数据库中访问较集中的一小部分数据存储在缓存服务器中，减少数据库的访问次数，降低数据库的访问压力  
系统访问特点遵循二八定律，即80%的业务访问集中在20%的数据上  
缓存分为本地缓存和远程分布式缓存，本地缓存访问速度更快但缓存数据量有限，同时存在与应用程序争用内存的情况。  
**解决方案：** Redis、Nosql、ORM框架的缓存机制、ehcache（分布式缓存框架）  

**系统架构演化历程-使用应用服务器集群**  
分库分表之后，数据库，压力一切正常，之后查看webserver，发现apache阻塞了很多的请求  
而应用服务器对每个请求也是比较快的，看来 是请求数太高导致需要排队等待，响应速度变慢  
多台服务器通过负载均衡同时向外部提供服务，解决单台服务器处理能力和存储空间上限的问题  
用集群是系统解决高并发、海量数据问题的常用手段。通过向集群中追加资源，提升系统的并发处理能力，使得服务器的负载压力不再成为整个系统的瓶颈。  
**解决方案：** tomcat+Apache HTTP Server+redis、Nginx+Tomcat+redis、Nginx+Tomcat+Memcached  

**系统架构演化历程-数据库读写分离**  
数据库写入、更新的这些操作的部分数据库连接的资源竞争非常激烈，导致了系统变慢。  
读写分离，是把对数据库读和写的操作分开对应不同的数据库服务器。主数据库提供写操作，从数据库提供读操作。当主数据库进行写操作时，数据要同步到从的数据库，有效保证数据库完整性。  
Quest SharePlex就是比较牛的同步数据工具，听说比oracle本身的流复制还好，MySQL也有自己的同步数据技术。  
mysql只要是通过二进制日志来复制数据。通过日志在从数据库重复主数据库的操作达到复制数据目的。这个复制比较好的就是通过异步方法，把数据同步到从数据库。  
读的操作怎么样分配到从数据库上？应该根据服务器的压力把读的操作分配到服务器，而不是简单的随机分配。mysql提供了MySQL-Proxy实现读写分离操作。不过MySQL-Proxy好像很久不更新了。oracle可以通过F5有效分配读从数据库的压力。  
**解决方案：** mysql有Mysql Proxy、Amoeba、Atlas  

**系统架构演化历程-反向代理和CDN加速**  
为了应付复杂的网络环境和不同地区用户的访问，通过CDN和反向代理加快用户访问的速度，同时减轻后端服务器的负载压力。CDN与反向代理的基本原理都是缓存。  
**解决方案：** Nginx，apache  
CDN:目的是使用户可就近取得所需内容，解决Internet网络拥挤的状况，提高用户访问网站的相应速度。  
![](http://images2015.cnblogs.com/blog/451342/201609/451342-20160927093532953-286579382.png)  
反向代理（Reverse Proxy）方式是指以代理服务器来接受internet上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给internet上请求连接的客户端，  
此时代理服务器对外就表现为一个反向代理服务器。这样做的好处是保护了真实的服务器  
![](http://images2015.cnblogs.com/blog/451342/201609/451342-20160927093609922-842514677.png)  

**系统架构演化历程-分布式文件系统和分布式数据库**  
发现分库后查询仍然会有些慢，于是按照分库的思想开始做分表的工作  
数据库采用分布式数据库（所有节点的数据加起来才算是整体数据），文件系统采用分布式文件系统  
任何强大的单一服务器都满足不了大型系统持续增长的业务需求，数据库读写分离随着业务的发展最终也将无法满足需求，需要使用分布式数据库及分布式文件系统来支撑。  
分布式数据库是系统数据库拆分的最后方法，只有在单表数据规模非常庞大的时候才使用，更常用的数据库拆分手段是业务分库，将不同的业务数据库部署在不同的物理服务器上。  
**解决方案：** mysql有mysql cluster 和 Mysql Proxy;mongodb(是一个基于分布式文件存储的数据库)  
分布式文件系统方案：CEPH、glusterfs、fastDFS、mogilefs 、moosefs，Hadoop实现了一个分布式文件系统（Hadoop Distributed File System）  

**系统架构演化历程-使用NoSQL和搜索引擎**  
特征：系统引入NoSQL数据库及搜索引擎。  
描述：随着业务越来越复杂，对数据存储和检索的需求也越来越复杂，系统需要采用一些
非关系型数据库如NoSQL和分数据库查询技术如搜索引擎。应用服务器通过统一数据访问模块访问各种数据，减轻应用程序管理诸多数据源的麻烦。  

**系统架构演化历程-业务拆分**  
特征：系统上按照业务进行拆分改造，应用服务器按照业务区分进行分别部署。  
描述：为了应对日益复杂的业务场景，通常使用分而治之的手段将整个系统业务分成不同的产品线，应用之间通过超链接建立关系，也可以通过消息队列进行数据分发，更多的还是通过访问同一个数据存储系统来构成一个关联的完整系统。  

纵向拆分：将一个大应用拆分为多个小应用，如果新业务较为独立，那么就直接将其设计部署为一个独立的Web应用系统纵向拆分相对较为简单，通过梳理业务，将较少相关的业务剥离即可。  
横向拆分：将复用的业务拆分出来，独立部署为分布式服务，新增业务只需要调用这些分布式服务横向拆分需要识别可复用的业务，设计服务接口，规范服务依赖关系。  

**系统架构演化历程-分布式服务**  
特征：公共的应用模块被提取出来，部署在分布式服务器上供应用服务器调用。  
描述：随着业务越拆越小，应用系统整体复杂程度呈指数级上升，由于所有应用要和所有数据库系统连接，最终导致数据库连接资源不足，拒绝服务。  

**分布式服务应用会面临哪些问题?**  
> * 当服务越来越多时，服务URL配置管理变得非常困难，F5硬件负载均衡器的单点压力也越来越大  
> * 当进一步发展，服务间依赖关系变得错踪复杂，甚至分不清哪个应用要在哪个应用之前启动，架构师都不能完整的描述应用的架构关系。  
> * 接着，服务的调用量越来越大，服务的容量问题就暴露出来，这个服务需要多少机器支撑？什么时候该加机器？  
> * 服务多了，沟通成本也开始上升，调某个服务失败该找谁？服务的参数都有什么约定？   
> * 一个服务有多个业务消费者，如何确保服务质量？  
> * 随着服务的不停升级，总有些意想不到的事发生，比如cache写错了导致内存溢出，故障不可避免，每次核心服务一挂，影响一大片，人心慌慌，如何控制故障的影响面？服务是否可以功能降级？或者资源劣化？   

**JAVA分布式应用技术基础**  
**分布式服务下的关键技术：消息队列架构**  
消息对列通过消息对象分解系统耦合性，不同子系统处理同一个消息。  

**分布式服务下的关键技术：服务框架架构**  
服务框架通过接口分解系统耦合性，不同子系统通过相同的接口描述进行服务启用  
服务框架是一个点对点模型  
服务框架面向同构系统  
适合：移动应用、互联网应用、外部系统  

**分布式服务下的关键技术：服务总线架构**  
服务总线同服务框架一样，均是通过接口分解系统耦合性，不同子系统通过相同的接口描述进行服务启用  
服务总线是一个总线式的模型  
服务总线面向同构、异构系统  
适合：内部系统  

**分布式架构下系统间交互的5种通信模式**  
> * request/response模式（同步模式）：客户端发起请求一直阻塞到服务端返回请求为止。  
> * Callback（异步模式）：客户端发送一个RPC请求给服务器，服务端处理后再发送一个消息给消息发送端提供的callback端点，此类情况非常合适以下场景：A组件发送RPC请求给B，B处理完成后，需要通知A组件做后续处理。  
> * Future模式：客户端发送完请求后，继续做自己的事情，返回一个包含消息结果的Future对象。客户端需要使用返回结果时，使用Future对象的.get(),如果此时没有结果返回的话，会一直阻塞到有结果返回为止。  
> * Oneway模式：客户端调用完继续执行，不管接收端是否成功。  
> * Reliable模式：为保证通信可靠，将借助于消息中心来实现消息的可靠送达，请求将做持久化存储，在接收方在线时做送达，并由消息中心保证异常重试。  

**五种通信模式的实现方式-同步点对点服务模式**  
**五种通信模式的实现方式-异步点对点消息模式1**  
**五种通信模式的实现方式-异步点对点消息模式2**  
**五种通信模式的实现方式-异步广播消息模式**  

**分布式架构下的服务治理**  
服务治理是服务框架/服务总线的核心功能。  
所谓服务治理，是指服务的提供方和消费方达成一致的约定，保证服务的高质量。  
服务治理功能可以解决将某些特定流量引入某一批机器，以及限制某些非法消费者的恶意访问，并在提供者处理量达到一定程度是，拒绝接受新的访问。  

**Dubbo，** 分布式服务框架,淘宝开源的。致力于提供高性能和透明化的RPC远程服务调用方案,是阿里巴巴SOA服务化治理方案的核心框架.

**基于服务框架Dubbo的服务治理-服务管理**  
> * 可以知道你的系统，对外提供了多少服务，可以对服务进行升级、降级、停用、权重调整等操作  
> * 可以知道你提供的服务，谁在使用，因业务需求，可以对该消费者实施屏蔽、停用等操作  

**基于服务框架Dubbo的服务治理-服务监控**  
> * 可以统计服务的每秒请求数、平均响应时间、调用量、峰值时间等，作为服务集群规划、性能调优的参考指标。  

**基于服务框架Dubbo的服务治理-服务路由**  
**基于服务框架Dubbo的服务治理-服务保护**
**基于服务总线OSB的服务治理-功能介绍**

 



